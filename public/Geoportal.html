<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Geoportal</title>
  <!-- Incluir los estilos de Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    /* Estilos globales */
    body {
      font-family: 'Roboto', sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f4f7fc;
      color: #333;
    }
    h1 {
      text-align: center;
      color: #4CAF50;
      margin-top: 20px;
      font-weight: 500;
    }
    p {
      text-align: center;
      font-size: 1.1rem;
      color: #555;
      margin-bottom: 20px;
    }

    /* Estilos para el mapa */
    #map {
      height: 500px;
      width: 100%;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      margin: 20px auto;
      position: relative;
    }

    /* Estilos para la lista de ubicaciones */
    .location-list {
      margin: 20px auto;
      padding: 0;
      width: 80%;
      list-style-type: none;
      border-radius: 8px;
      background: #ffffff;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      max-height: 300px;
      overflow-y: auto;
    }

    .location-list li {
      padding: 10px 20px;
      border-bottom: 1px solid #f2f2f2;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: background-color 0.3s ease;
    }

    .location-list li:hover {
      background-color: #f9f9f9;
    }

    .location-list li:last-child {
      border-bottom: none;
    }

    .location-list li button {
      background-color: #f44336;
      color: white;
      border: none;
      padding: 5px 10px;
      font-size: 1rem;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    .location-list li button:hover {
      background-color: #d32f2f;
    }

    /* Estilo para los botones */
    .btn {
      padding: 10px 20px;
      font-size: 1rem;
      color: white;
      background-color: #4CAF50;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      display: block;
      margin: 20px auto;
      width: 200px;
      text-align: center;
      transition: background-color 0.3s ease;
    }

    .btn:hover {
      background-color: #45a049;
    }

    /* Estilos del menú deslizante */
    .slide-menu {
      position: fixed;
      top: 0;
      right: -300px;
      width: 300px;
      height: 100%;
      background-color: #fff;
      box-shadow: -2px 0 10px rgba(0, 0, 0, 0.1);
      transition: right 0.3s ease;
      padding: 20px;
      overflow-y: auto;
      z-index: 1050;
      opacity: 0;
      visibility: hidden;
    }

    .slide-menu.active {
      right: 0;
      opacity: 1;
      visibility: visible;
    }

    .close-btn {
      font-size: 1.5rem;
      color: #333;
      cursor: pointer;
      background: none;
      border: none;
      display: block;
      margin-bottom: 20px;
      transition: color 0.3s ease;
    }

    .close-btn:hover {
      color: #f44336;
    }

    .slide-menu h3 {
      color: #4CAF50;
      margin-bottom: 15px;
    }

    .slide-menu .data {
      margin-bottom: 15px;
    }

    /* Estilo de los popups */
    .popup-content {
      font-size: 1rem;
      color: #333;
    }

    /* Responsividad */
    @media (max-width: 768px) {
      #map {
        height: 400px;
      }

      .location-list {
        width: 90%;
      }

      .btn {
        width: 180px;
      }
    }
  </style>
</head>
<body>
  <h1>Geoportal</h1>
  <p>Visualiza y gestiona las ubicaciones guardadas en el mapa.</p>

  <!-- Contenedor del mapa -->
  <div id="map"></div>

  <h3>Ubicaciones guardadas</h3>
  <ul id="saved-locations" class="location-list"></ul>

  <button class="btn" onclick="addNewMarker()">Agregar nueva ubicación</button>

  <!-- Menú deslizante para mostrar métricas adicionales -->
  <div id="slide-menu" class="slide-menu">
    <button class="close-btn" onclick="closeSlideMenu()">×</button>
    <h3>Información adicional</h3>
    <div id="metrics-content" class="data">
      <p>Cargando datos...</p>
    </div>
  </div>

  <!-- Incluir los scripts de Leaflet -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>
  <script>
    // Inicializar el mapa
    var map = L.map('map').setView([40.7128, -74.0060], 13); // Coordenadas de inicio (Nueva York)

    // Agregar capa de mapas base (OpenStreetMap)
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);

    // Control de búsqueda de ubicaciones (usando geocodificador)
    var geocoder = L.Control.Geocoder.nominatim();
    var searchControl = L.Control.geocoder({
      geocoder: geocoder
    }).addTo(map);

    // Lista para almacenar las ubicaciones guardadas
    var savedLocations = [];
    var markers = []; // Para almacenar los marcadores agregados

    // Función para agregar un marcador al hacer clic en el mapa
    map.on('click', function(e) {
      addMarker(e.latlng.lat, e.latlng.lng);
    });

    // Función para agregar un nuevo marcador
    function addMarker(lat, lng) {
      var marker = L.marker([lat, lng]).addTo(map);
      savedLocations.push({ lat: lat, lng: lng });
      marker.bindPopup(`
        <div class="popup-content">
          <p><strong>Lat:</strong> ${lat}</p>
          <p><strong>Lng:</strong> ${lng}</p>
          <p><strong>Información adicional:</strong></p>
          <ul>
            <li>Área: 500 m²</li>
            <li>Cultivo: Maíz</li>
            <li>Propietario: Juan Pérez</li>
          </ul>
        </div>
      `);
      markers.push(marker);
      updateLocationList();
    }

    // Función para actualizar la lista de ubicaciones guardadas
    function updateLocationList() {
      var locationList = document.getElementById('saved-locations');
      locationList.innerHTML = '';
      savedLocations.forEach(function(location, index) {
        var li = document.createElement('li');
        li.innerHTML = `Lat: ${location.lat}, Lng: ${location.lng}`;
        var deleteBtn = document.createElement('button');
        deleteBtn.innerText = 'Eliminar';
        deleteBtn.onclick = function() {
          removeLocation(index);
        };
        li.appendChild(deleteBtn);
        locationList.appendChild(li);
      });
    }

    // Función para eliminar una ubicación
    function removeLocation(index) {
      savedLocations.splice(index, 1);
      markers[index].remove();
      markers.splice(index, 1);
      updateLocationList();
    }

    // Función para agregar una nueva ubicación manualmente
    function addNewMarker() {
      var lat = parseFloat(prompt('Introduce la latitud:'));
      var lng = parseFloat(prompt('Introduce la longitud:'));
      if (!isNaN(lat) && !isNaN(lng)) {
        addMarker(lat, lng);
      } else {
        alert('Por favor, introduce valores válidos');
      }
    }

    // Función para abrir el menú deslizante (si es necesario)
    function openSlideMenu() {
      document.getElementById('slide-menu').classList.add('active');
    }

    // Función para cerrar el menú deslizante
    function closeSlideMenu() {
      document.getElementById('slide-menu').classList.remove('active');
    }
  </script>
</body>
</html>
